<!DOCTYPE html>
<html>
	<head>
		<title>DuLeone Craps</title>
		<link href="layout.css" media="all" rel="stylesheet" type="text/css" />
	</head>
	<body>
		<!-- canvas id="board" height='1024' width='768'></canvas -->
		<canvas id="board" height='768' width='1024'></canvas>
		<button id='roll' onclick='roll()'>Roll</button>
		<button id='reset' onclick='reset()'>Reset Bets</button><br />
		<div id='buffer'></div>
		
		<div id='betForm'>
			<fieldset id='betInfo'>	
				<legend>Create a Bet!</legend>
				<p>
					<label for='betType'>Bet Type</label>
					<select id='betType' name='betType'>
						<option value="passline">Pass Line Bet</option>
						<option value="passlineOdds">Pass Line Odds</option>
						<option value="come">Come Bet</option>
						<option value="comeOdds">Come Odds</option>
						<option value="dontPass">Don't Pass Line Bet</option>
						<option value="dontPassOdds">Don't Pass Line Odds</option>
						<option value="dontCome">Don't Come Bet</option>
						<option value="dontComeOdds">Don't Come Odds</option>
						<option value="place4">Place 4</option>
						<option value="place5">Place 5</option>
						<option value="place6">Place 6</option>
						<option value="place8">Place 8</option>
						<option value="place9">Place 9</option>
						<option value="place10">Place 10</option>
						<option value="hard4">Hard 4</option>
						<option value="hard6">Hard 6</option>
						<option value="hard8">Hard 8</option>
						<option value="hard10">Hard 10</option>
						<option value="field">Field</option>
						<option value="cAndE">C and E</option>
						<option value="any7">Any 7</option>
						<option value="anyCraps">Any Craps</option>
						<option value="horn">Horn</option>
						<option value="aceTwo">Ace Two</option>
						<option value="shakeEyes">Snake Eyes</option>
						<option value="midnight">Midnight</option>
						<option value="yoleven">Yo-leven</option>
						<option value="big6">Big 6</option>
						<option value="big8">Big 8</option>
						<option value="world">World</option>
					</select>
				</p>
				<p>
					<label for='betValue'>Bet Value</label>
					<input id='betValue' name='betValue' type='text'>
				</p>
				<p>
					<label for='repeat'>Repeat Bet on Win?</label>
					<input id='betRepeat' name='betRepeat' type='checkbox'>
				</p>
				<p id='origBet'></p>
				<p>
					<button id='create'>Create that Bet!</button>
				</p>
			</fieldset>
		</div>
		<div id='betListing'></div>
		<div id='playerArea'>
			<fieldset id='playerInfo'>
				<legend>Player Info!</legend>
				<div id='name'></div>
				<div id='bank'></div>
			</fieldset>
		</div>
		<div id='tableInfo'></div>
		<div id='pointWindow'></div>
		
	</body>
	<footer>

		<script src="jquery.min.js" lang='javascript' type='text/javascript'></script>
		<script src="jquery.color.js" lang='javascript' type='text/javascript'></script>
		<script type='text/javascript' language='javascript' src='utils.js'></script>
		<script type='text/javascript' language='javascript' src='dice.js'></script>
		<script type='text/javascript' language='javascript' src='crapsDice.js'></script>
		<script type='text/javascript' language='javascript' src='bets.js'></script>
		<script type='text/javascript' language='javascript' src='crapsBets.js'></script>
		<script type='text/javascript' language='javascript' src='players.js'></script>
		<script type='text/javascript' language='javascript' src='crapsPlayers.js'></script>
		<script type='text/javascript' language='javascript' src='craps.js'></script>
		<script type='text/javascript' language='javascript' src='board.js'></script>

		<script type='text/javascript' language='javascript'>		
			makeCrapsPlayer("Matt", 10000);
			//_CRAPS.players = [p];

			var p = PlayerManager.players[0];
			PlayerManager.updatePlayerArea();
			
			var BET_FADE_INTERVAL = 2000;
			//_CRAPS.placeBet(p.createBet('hard4', 1000));
			//_CRAPS.placeBet(p.createBet('hard6', 1500));
			//_CRAPS.placeBet(p.createBet('passline', 1000));

			function roll(){
				_CRAPS.output("---Rolling---");
				_CRAPS.roll();
				$('#pointWindow').html('Point: ' + ((GameState.point>0)?GameState.point:'None'));
				if($('.winningBet').is(':animated') || $('.losingBet').is(':animated')){
					var animateTimeout = setInterval(
						function(){
							_CRAPS.dealer.betManager.displayBets();
							clearInterval(animateTimeout);
						}, BET_FADE_INTERVAL);
				}else{
					_CRAPS.dealer.betManager.displayBets();
				}
			}
			
			function reset(){
				var _bets = _CRAPS.dealer.betManager.bets
				for(x in _bets){
					if(_bets[x].type == 'passline'){
						if(GameState.point > 0){
							continue;
						}else{
							_CRAPS.dealer.betManager.removeBet(_bets[x].bet.betId);
						}
					}
					if(_bets[x].type == 'come'){
						if(_bets[x].point > 0){
							continue;
						}else{
							_CRAPS.dealer.betManager.removeBet(_bets[x].bet.betId);
						}
					}
					_CRAPS.dealer.betManager.removeBet(_bets[x].bet.betId);
				}
			}
		</script>
		<!-- Draw Tabletop -->
		<script type='text/javascript' language='javascript'>
			var canvas = document.getElementById("board");
			var board = canvas.getContext("2d");

			var colors = {
				black: "#000",
				board: "#090",
				lines: "#fff"
			};

			var thick = {
				boardframe: 20,
				boardlines: 8
			}

			//var _h = 1024, _w = 768;
			// Use size of actual canvas, allows for future flexibility. --dracoling
			var _h = canvas.height, _w = canvas.width;
			//var _h = 640, _w = 800;
			var _l = 0, _r = _w;
			var _t = 0, _b = _h;
			var d = new DrawCanvas(board, _l, _t, _w, _h, colors);

			var pa = { /* pa = Playing Area */
				_h: d.perimeterAdjust.h(_h),
				_w: d.perimeterAdjust.w(_w),
				_l: d.perimeterAdjust.l(_l),
				_r: d.perimeterAdjust.r(_r),
				_t: d.perimeterAdjust.t(_t),
				_b: d.perimeterAdjust.b(_b)
			};

			d.resetBoard();
			var boardEtc = {
				color: colors.lines,
				t: thick.boardlines
			}

            var halfthick = parseInt(boardEtc.t/2);
            var gutter = parseInt(pa._w/10);
            var passlinewidth = parseInt(gutter * (pa._h/pa._w));
            var gutterplus = parseInt(gutter * 1);

            d.line(
            	pa._l + gutter - halfthick,
            	pa._t + gutter,
            	pa._r - halfthick,
            	pa._t + gutter,
            	boardEtc
            );
            d.line(
            	pa._r - halfthick,
            	pa._t + gutter - halfthick,
            	pa._r - halfthick,
            	pa._b - gutter,
            	boardEtc
            );
            d.line(
            	pa._l + gutter - halfthick,
            	pa._t + gutter - halfthick,
            	pa._l + gutter - halfthick,
            	pa._b - gutterplus - gutter,
            	boardEtc
            );
            d.line(
            	pa._l + (gutterplus * 2) - halfthick,
            	pa._b - gutter - halfthick ,
            	pa._r - halfthick,
            	pa._b - gutter - halfthick,
            	boardEtc
            );
            d.curve(
            	pa._l + gutter - halfthick,
            	pa._b - gutterplus - gutter,
            	pa._l + (gutterplus * 2) - halfthick,
            	pa._b - gutter - halfthick,
            	pa._l + gutter - halfthick,
            	pa._b - gutter - halfthick,
            	boardEtc
            );


            d.line(
            	pa._l + gutter - halfthick + passlinewidth,
            	pa._t + gutter - halfthick,
            	pa._l + gutter - halfthick + passlinewidth,
            	pa._b - gutterplus - passlinewidth - gutter,
            	boardEtc
            );
            d.line(
            	pa._l + ((gutterplus * 2 + passlinewidth)) - halfthick,
            	pa._b - gutter - halfthick - passlinewidth,
            	pa._r - halfthick,
            	pa._b - gutter - halfthick - passlinewidth,
            	boardEtc
            );
            d.curve(
            	pa._l + gutter - halfthick + passlinewidth,
            	pa._b - gutterplus - passlinewidth - gutter,
            	pa._l + ((gutterplus * 2 + passlinewidth)) - halfthick,
            	pa._b - gutter - halfthick - passlinewidth,
            	pa._l + gutter - halfthick + passlinewidth,
            	pa._b - gutter - halfthick - passlinewidth,
            	boardEtc
            );

//pa._l + gutter - halfthick + ((pa._l + (150 * (pa._w/pa._h)) - halfthick,) - (pa._l + gutter - halfthick))/2,            
/*
			d.line(pa._l + 100, pa._t + 100, pa._r, pa._t + 100, boardEtc);
			d.line(pa._r, pa._t + 100, pa._r, pa._b, boardEtc);
			d.line(pa._l + 100, pa._t + 100, pa._l+100, pa._b-150, boardEtc);
*/
			//d.line(pa._l + 100, pa._t + 100, pa._l+100, pa._b-150, boardEtc);
			//d.demo(24);
		</script>
		<script type='text/javascript' lang='javascript'>
			$('#betValue').attr('value', _CRAPS.minBet);
			$('#tableInfo').append($(document.createElement('p')).html('3x-4x-5x Odds <br /> Table Min Bet: $' + _CRAPS.minBet + '<br /> Table Max Bet: $' + _CRAPS.maxBet));
			$('#pointWindow').html('Point: ' + ((GameState.point>0)?GameState.point:'None'));
			$('#betType').change(function(){
				$('#origBet').empty();
				if(['passlineOdds', 'comeOdds', 'dontPassOdds', 'dontComeOdds'].indexOf($('#betType').val()) != -1){
					var origBet = $('#origBet');
					var origLabel = $(document.createElement('label'));
					var orig = $(document.createElement('input'));
					orig.attr('type', 'text');
					orig.attr('id', 'orig');
					origLabel.html('Original Bet ID: ');
					origBet.append(origLabel).append(orig);
				}
			});
			$("#betForm button").click(function(){
				//console.log($('#betType').val());
				//console.log($('#betValue').val());
				//console.log($('#betRepeat').is(':checked'));
				//console.log(parseInt($('#betValue').val()));
				var origBet = null;
				if(['passlineOdds', 'comeOdds', 'dontPassOdds', 'dontComeOdds'].indexOf($('#betType').val()) != -1){
					origBet = _CRAPS.dealer.betManager.getBetById($('#orig').val());
				}
				var newBet = p.createBet($('#betType').val(), parseInt($('#betValue').val()), $('#betRepeat').is(':checked'), origBet);
				//console.log('Placing bet:', newBet.toString());
				_CRAPS.placeBet(newBet);
				PlayerManager.updatePlayerArea();
				//alert("You clicked submit!");
			});
		</script>
		</footer>
</html>
